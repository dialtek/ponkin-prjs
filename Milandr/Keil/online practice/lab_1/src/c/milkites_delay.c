#include "MDR32Fx.h" 
#include "milkites_delay.h"

void delay_init(void)
{
    /// ????????????? ?????????? ???????
  
	SysTick->CTRL |= (1<<2) | (0<<1); // ???????? ?????????????: HCLK 									  

}

uint8_t SysTickTimer_set (uint32_t ticks)
{
	
    // ??????? Reload - 24 ???, ???????? ?? ????????????
    if (ticks > 0x00FFFFFF)  return (1);           /* Reload value impossible */
	
	SysTick->VAL  = 0;                             /* Load the SysTick Counter Value */
	SysTick->LOAD = ticks;
	
	SysTick->CTRL |= (0<<16) | 1;				   // J,yektybt COUNTFLAG, SysTickTimerStart 
	return (0);                                    /* Function successful */
	
/*
??? ???????????? ?????????? ?????????? ????? ???????? ? N ?????? ?????????? 
???????????? ???????? N. ????????, ???? ????????? ?????????? ????? 400 ?????? 
??????????, ?? ??????????????? RELOAD, ?????? 400.  
*/
}


void  delay_ms(uint32_t delay)
{
		  uint32_t i;
	    for(i = 0; i < delay; i++)
		{
			SysTickTimer_set((F_CPU/1000)-1); // 1 ms ??? HCLK = 80 M
			while(!(SysTick->CTRL & (1<<16)));
		}
}

